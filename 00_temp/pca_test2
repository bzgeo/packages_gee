// Last updated: 08.05.2025

var a = require('users/bzgeo/hyperspectral_toolkit:00_pkg/ref_data_pace_oci');
var b = require('users/bzgeo/hyperspectral_toolkit:00_pkg/emit_hyperion_pace');

//var img = a.pace_oci_mt_mes_img;
var img = ee.Image("users/servirbz/x_tmp/hyperspectral/mes_pace_oci_sr_202403_202503");
print(img);

var roi = img.geometry().bounds();

var coll = a.pace_oci_mt_mes;
print(coll);

var med = coll.median();
var min = coll.min();
var max = coll.max();

//var img2 = ee.Image.cat([min,med,max]).clip(roi);
var img2 = ee.Image.cat([med,max]).clip(roi);
print(img2);

var pca = b.pca(img2);
print(pca);

b.variance_pca(img2);

var img2b = ee.Image.cat([min,med,max]).clip(roi);
var pca2 = b.pca(img2b);

/*
Export.image.toAsset({
  image: pca.select(["pc1","pc2","pc3"]), assetId: 'users/servirbz/x_tmp/hyperspectral/mes_pace_oci_sr_202403_202503_pca_01',
  description: 'export_ee_2_pca', region: pca.geometry().bounds(), scale: pca.projection().nominalScale(), maxPixels: 1e13});
*/

Export.image.toAsset({
  image: pca.select(["pc1","pc2","pc3"]), assetId: 'users/servirbz/x_tmp/hyperspectral/mes_pace_oci_sr_202403_202503_pca_02',
  description: 'export_ee_2a_pca', region: pca.geometry().bounds(), scale: 4000, maxPixels: 1e13});

Export.image.toAsset({
  image: pca2.select(["pc1","pc2","pc3"]), assetId: 'users/servirbz/x_tmp/hyperspectral/mes_pace_oci_sr_202403_202503_pca_01b',
  description: 'export_ee_2b_pca', region: pca.geometry().bounds(), scale: 4000, maxPixels: 1e13});


var img3 = ee.Image("users/servirbz/x_tmp/hyperspectral/mes_pace_oci_sr_202403_202503_pca_02");
var img4 = ee.Image("users/servirbz/x_tmp/hyperspectral/mes_pace_oci_sr_202403_202503_pca_01b");

Map.addLayer(img2,{}, 'Image 1', 0);
Map.addLayer(img3,{}, 'PCA', 0);
Map.addLayer(img4,{}, 'PCA2', 0);